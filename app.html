<!DOCTYPE html>
<html lang="da-DK">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IBOS - Skaktern</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <link rel="stylesheet" href="style.css">
    <style>
        .fullscreen-notice {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 2px solid #ffc107;
            border-radius: 12px;
            padding: 16px 24px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            z-index: 10000;
            max-width: 500px;
            display: none;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .fullscreen-notice-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .fullscreen-notice-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .fullscreen-notice-text {
            flex: 1;
        }

        .fullscreen-notice-text p {
            margin: 0;
            font-size: 14px;
            color: #1f1f1f;
            line-height: 1.5;
        }

        .fullscreen-notice-text strong {
            font-weight: 600;
            display: block;
            margin-bottom: 4px;
        }

        .fullscreen-notice-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            padding: 4px;
            line-height: 1;
            color: #666;
            transition: color 0.2s;
        }

        .fullscreen-notice-close:hover {
            color: #000;
        }

        .fullscreen-button {
            margin-top: 8px;
            padding: 8px 16px;
            background-color: #ffc107;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .fullscreen-button:hover {
            background-color: #ffb300;
            transform: translateY(-1px);
        }

        /* Sørg for at left-column stabler ikoner vertikalt og starter øverst */
        .left-column {
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding-top: 20px;
        }

        /* Fuldskærm toggle ikon i venstre sidebar */
        .fullscreen-toggle {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            z-index: 1001;
            color: white;
            transition: transform 0.2s ease;
            padding: 8px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 4px;
        }

        .fullscreen-toggle:hover, .fullscreen-toggle:focus {
            transform: scale(1.1);
            background-color: rgba(255, 255, 255, 0.1);
        }

        .fullscreen-toggle:focus-visible {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }

        .fullscreen-toggle:active {
            transform: scale(0.95);
        }

        .fullscreen-icon {
            width: 24px;
            height: 24px;
            color: white;
        }

        /* Skjul fuldskærm toggle når menuen er åben */
        .off-canvas-menu.open ~ #leftColumn .fullscreen-toggle {
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <!-- Fuldskærms-bemærkning -->
    <div id="fullscreenNotice" class="fullscreen-notice" role="alert" aria-live="polite">
        <div class="fullscreen-notice-content">
            <div class="fullscreen-notice-icon" aria-hidden="true">⛶</div>
            <div class="fullscreen-notice-text">
                <strong>Bemærkning</strong>
                <p>For optimal brug anbefales det at køre appen i fuldskærm eller maksimeret vindue.</p>
                <button id="enterFullscreenBtn" class="fullscreen-button">Gå til fuldskærm</button>
                <p style="font-size: 12px; margin-top: 8px; opacity: 0.8;">Tryk ESC for at forlade fuldskærm</p>
            </div>
            <button id="closeFullscreenNotice" class="fullscreen-notice-close" aria-label="Luk bemærkning">×</button>
        </div>
    </div>
    <div id="confirmDialog" class="confirm-dialog">
        <div class="confirm-content">
            <h3>Er du sikker på at du vil nulstille alle indstillinger?</h3>
            <p>Denne handling kan ikke fortrydes.</p>
            <div class="confirm-buttons">
                <button id="confirmNo" class="confirm-no">Annuller</button>
                <button id="confirmYes" class="confirm-yes">Ja, nulstil</button>
            </div>
        </div>
    </div>

    <div class="main-container">
        <div id="leftColumn" class="left-column">
            <button id="menuToggle" class="menu-toggle" aria-label="Åbn menu" aria-expanded="false" aria-controls="offCanvasMenu" tabindex="0" title="Åbn menu"></button>
            <button id="fullscreenToggle" class="fullscreen-toggle" aria-label="Skift til fuldskærm" tabindex="0" title="Skift til fuldskærm (F11)">
                <svg class="fullscreen-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <!-- Expand icon (default) -->
                    <path class="expand-icon" d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
                    <!-- Compress icon (hidden by default) -->
                    <path class="compress-icon" style="display: none;" d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"/>
                </svg>
            </button>
        </div>
        <div id="offCanvasMenu" class="off-canvas-menu" role="navigation" aria-label="Indstillinger menu">
            <button id="closeMenuToggle" class="menu-toggle close-toggle" aria-label="Luk menu" tabindex="0"></button>
            <div id="controls">
                <form id="controlForm" class="menu">
                    <div class="menu-header">
                        <h1 class="menu-title">IBOS Skaktern</h1>
                        <p class="menu-subtitle">Indstillinger</p>
                    </div>

                    <div class="menu-content">
                        <fieldset>
                            <div class="legend-help-wrapper">
                                <legend>Generelle indstillinger</legend>
                                <span class="help-icon" data-help="generelleIndstillinger">?</span>
                            </div>
                            <div class="help-text" id="help-generelleIndstillinger"></div>

                            <div class="form-group">
                                <label for="squareSize">Ternstørrelse</label>
                                <input type="number" id="squareSize" value="10" min="5" step="5">
                            </div>
                            <div class="form-group">
                                <label for="interval">Tidsinterval</label>
                                <input type="number" id="interval" value="500">
                            </div>
                            <div class="form-group">
                                <label for="redSquareSizeMultiplier">Røde tern - forstørrelsesfaktor</label>
                                <select id="redSquareSizeMultiplier">
                                    <option value="1">1x</option>
                                    <option value="2">2x</option>
                                    <option value="3">3x</option>
                                    <option value="4">4x</option>
                                    <option value="5">5x</option>
                                </select>
                            </div>
                        </fieldset>

                        <div class="section-divider"></div>

                        <fieldset class="edges-fieldset">
                            <div class="legend-help-wrapper">
                                <legend>Kanter</legend>
                                <span class="help-icon" data-help="kanter">?</span>
                            </div>
                            <div class="help-text" id="help-kanter"></div>

                            <div class="edge-controls">
                                <div class="edge-visual">
                                    <div class="edge-border edge-border-top"></div>
                                    <div class="edge-border edge-border-right"></div>
                                    <div class="edge-border edge-border-bottom"></div>
                                    <div class="edge-border edge-border-left"></div>

                                    <div class="edge-input top">
                                        <label for="topRed">
                                            <span aria-hidden="true">Top</span>
                                            <span class="sr-only">Antal røde tern på top kant</span>
                                        </label>
                                        <select id="topRed" aria-label="Antal røde tern på top kant">
                                            <option value="0">0 tern</option>
                                            <option value="1">1 tern</option>
                                            <option value="2">2 tern</option>
                                            <option value="3">3 tern</option>
                                        </select>
                                    </div>

                                    <div class="edge-input right">
                                        <label for="rightRed">
                                            <span aria-hidden="true">Højre</span>
                                            <span class="sr-only">Antal røde tern på højre kant</span>
                                        </label>
                                        <select id="rightRed" aria-label="Antal røde tern på højre kant">
                                            <option value="0">0 tern</option>
                                            <option value="1">1 tern</option>
                                            <option value="2">2 tern</option>
                                            <option value="3">3 tern</option>
                                        </select>
                                    </div>

                                    <div class="edge-input bottom">
                                        <label for="bottomRed">
                                            <span aria-hidden="true">Bund</span>
                                            <span class="sr-only">Antal røde tern på bund kant</span>
                                        </label>
                                        <select id="bottomRed" aria-label="Antal røde tern på bund kant">
                                            <option value="0">0 tern</option>
                                            <option value="1">1 tern</option>
                                            <option value="2">2 tern</option>
                                            <option value="3">3 tern</option>
                                        </select>
                                    </div>

                                    <div class="edge-input left">
                                        <label for="leftRed">
                                            <span aria-hidden="true">Venstre</span>
                                            <span class="sr-only">Antal røde tern på venstre kant</span>
                                        </label>
                                        <select id="leftRed" aria-label="Antal røde tern på venstre kant">
                                            <option value="0">0 tern</option>
                                            <option value="1">1 tern</option>
                                            <option value="2">2 tern</option>
                                            <option value="3">3 tern</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="redSquareOffset">Afstand fra kanter</label>
                                    <select id="redSquareOffset">
                                        <option value="0">0</option>
                                        <option value="10">10</option>
                                        <option value="20">20</option>
                                        <option value="30">30</option>
                                        <option value="40">40</option>
                                        <option value="50">50</option>
                                        <option value="60" selected>60</option>
                                        <option value="70">70</option>
                                        <option value="80">80</option>
                                        <option value="90">90</option>
                                        <option value="100">100</option>
                                        <option value="110">110</option>
                                        <option value="120">120</option>
                                        <option value="130">130</option>
                                        <option value="140">140</option>
                                        <option value="150">150</option>
                                        <option value="160">160</option>
                                        <option value="170">170</option>
                                        <option value="180">180</option>
                                        <option value="190">190</option>
                                        <option value="200">200</option>
                                    </select>
                                </div>
                            </div>
                        </fieldset>

                        <div class="section-divider"></div>

                        <fieldset class="corners-fieldset">
                            <div class="legend-help-wrapper">
                                <legend>Hjørner</legend>
                                <span class="help-icon" data-help="hjorner">?</span>
                            </div>
                            <div class="help-text" id="help-hjorner"></div>

                            <div class="corner-controls">
                                <div class="corner-visual">
                                    <div class="corner-input top-left">
                                        <input type="checkbox" id="topLeftCorner">
                                        <label for="topLeftCorner">Top venstre</label>
                                    </div>

                                    <div class="corner-input top-right">
                                        <input type="checkbox" id="topRightCorner">
                                        <label for="topRightCorner">Top højre</label>
                                    </div>

                                    <div class="center-input">
                                        <input type="checkbox" id="centerSquare">
                                        <label for="centerSquare">Center</label>
                                    </div>

                                    <div class="corner-input bottom-left">
                                        <input type="checkbox" id="bottomLeftCorner">
                                        <label for="bottomLeftCorner">Bund venstre</label>
                                    </div>

                                    <div class="corner-input bottom-right">
                                        <input type="checkbox" id="bottomRightCorner">
                                        <label for="bottomRightCorner">Bund højre</label>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="cornerSquareOffset">Afstand fra hjørner</label>
                                    <select id="cornerSquareOffset">
                                        <option value="0">0</option>
                                        <option value="10">10</option>
                                        <option value="20">20</option>
                                        <option value="30">30</option>
                                        <option value="40">40</option>
                                        <option value="50">50</option>
                                        <option value="60" selected>60</option>
                                        <option value="70">70</option>
                                        <option value="80">80</option>
                                        <option value="90">90</option>
                                        <option value="100">100</option>
                                        <option value="110">110</option>
                                        <option value="120">120</option>
                                        <option value="130">130</option>
                                        <option value="140">140</option>
                                        <option value="150">150</option>
                                        <option value="160">160</option>
                                        <option value="170">170</option>
                                        <option value="180">180</option>
                                        <option value="190">190</option>
                                        <option value="200">200</option>
                                    </select>
                                </div>
                            </div>
                        </fieldset>
                    </div>

                    <div class="menu-footer">
                            <a href="manual.html" target="_blank" class="menu-link-button">
                                <span>Faglig vejledning</span>
                                <span class="arrow">→</span>
                            </a>
                            <a href="index.html" class="menu-link-button">
                                <span>Tilbage til forside</span>
                                <span class="arrow">→</span>
                            </a>
                    </div>

                    <div class="fixed-buttons">
                        <button type="submit" aria-label="Opdater indstillinger">Opdater</button>
                        <button id="copyLinkButton" type="button" aria-label="Kopier link til udklipsholder">Kopier aktuelt link</button>
                        <button id="reloadButton" type="button" aria-label="Nulstil alle indstillinger">Nulstil</button>
                    </div>
                </form>
            </div>
        </div>
        <div id="chessboard-container"></div>
    </div>

    <!-- Aria-live region for skærmlæser annonceringer -->
    <div id="ariaLiveRegion" aria-live="polite" aria-atomic="true" class="sr-only"></div>

    <script>
        // Tjek om vinduet er i fuldskærm eller maksimeret
        function checkFullscreenOrMaximized() {
            // Tjek om browseren er i fuldskærm mode
            const isFullscreen = !!(
                document.fullscreenElement ||
                document.webkitFullscreenElement ||
                document.mozFullScreenElement ||
                document.msFullscreenElement
            );

            // Tjek om vinduet er maksimeret (eller tæt på det)
            // Vi giver lidt margin (50px) for at tage højde for OS taskbar osv.
            const isMaximized = (
                window.innerWidth >= (screen.availWidth - 50) &&
                window.innerHeight >= (screen.availHeight - 50)
            );

            return isFullscreen || isMaximized;
        }

        // Vis/skjul bemærkning baseret på fuldskærms-status
        function updateFullscreenNotice() {
            const notice = document.getElementById('fullscreenNotice');
            const isOptimal = checkFullscreenOrMaximized();

            // Tjek om brugeren har lukket bemærkningen manuelt (gem i sessionStorage)
            const userDismissed = sessionStorage.getItem('fullscreenNoticeDismissed') === 'true';

            const shouldShow = !isOptimal && !userDismissed;
            const wasHidden = notice.style.display === 'none' || !notice.style.display;

            if (shouldShow) {
                notice.style.display = 'block';

                // Annoncér til skærmlæsere hvis bemærkningen lige er blevet vist
                if (wasHidden) {
                    const ariaLive = document.getElementById('ariaLiveRegion');
                    if (ariaLive) {
                        ariaLive.textContent = 'Bemærkning: For optimal brug anbefales det at køre appen i fuldskærm eller maksimeret vindue. Tryk ESC for at forlade fuldskærm.';
                        setTimeout(() => { ariaLive.textContent = ''; }, 3000);
                    }
                }
            } else {
                notice.style.display = 'none';
            }
        }

        // Toggle fuldskærm funktion
        function toggleFullscreen() {
            const elem = document.documentElement;

            if (!document.fullscreenElement &&
                !document.webkitFullscreenElement &&
                !document.mozFullScreenElement &&
                !document.msFullscreenElement) {
                // Gå til fuldskærm
                if (elem.requestFullscreen) {
                    elem.requestFullscreen();
                } else if (elem.webkitRequestFullscreen) {
                    elem.webkitRequestFullscreen();
                } else if (elem.mozRequestFullScreen) {
                    elem.mozRequestFullScreen();
                } else if (elem.msRequestFullscreen) {
                    elem.msRequestFullscreen();
                }
            } else {
                // Forlad fuldskærm
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
            }
        }

        // Opdater fuldskærm toggle ikon
        function updateFullscreenToggleIcon() {
            const isFullscreen = !!(
                document.fullscreenElement ||
                document.webkitFullscreenElement ||
                document.mozFullScreenElement ||
                document.msFullscreenElement
            );

            const toggleBtn = document.getElementById('fullscreenToggle');
            const expandIcon = toggleBtn?.querySelector('.expand-icon');
            const compressIcon = toggleBtn?.querySelector('.compress-icon');

            if (isFullscreen) {
                expandIcon.style.display = 'none';
                compressIcon.style.display = 'block';
                toggleBtn.setAttribute('aria-label', 'Forlad fuldskærm');
                toggleBtn.setAttribute('title', 'Forlad fuldskærm (ESC)');
            } else {
                expandIcon.style.display = 'block';
                compressIcon.style.display = 'none';
                toggleBtn.setAttribute('aria-label', 'Skift til fuldskærm');
                toggleBtn.setAttribute('title', 'Skift til fuldskærm (F11)');
            }
        }

        // Fuldskærm toggle knap i sidebar
        document.getElementById('fullscreenToggle')?.addEventListener('click', function() {
            toggleFullscreen();
        });

        // Tastatur support for fuldskærm toggle
        document.getElementById('fullscreenToggle')?.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                toggleFullscreen();
            }
        });

        // Gå til fuldskærm når brugeren klikker på knappen i notice
        document.getElementById('enterFullscreenBtn')?.addEventListener('click', function() {
            toggleFullscreen();
        });

        // Opdater ikon når fuldskærms-status ændres
        document.addEventListener('fullscreenchange', updateFullscreenToggleIcon);
        document.addEventListener('webkitfullscreenchange', updateFullscreenToggleIcon);
        document.addEventListener('mozfullscreenchange', updateFullscreenToggleIcon);
        document.addEventListener('msfullscreenchange', updateFullscreenToggleIcon);

        // Luk bemærkning og gem i session
        document.getElementById('closeFullscreenNotice')?.addEventListener('click', function() {
            sessionStorage.setItem('fullscreenNoticeDismissed', 'true');
            document.getElementById('fullscreenNotice').style.display = 'none';
        });

        // Tjek ved page load
        window.addEventListener('load', function() {
            // Vent lidt så siden er helt loaded
            setTimeout(updateFullscreenNotice, 500);
            // Opdater fuldskærm toggle ikon
            updateFullscreenToggleIcon();
        });

        // Tjek når vinduet ændrer størrelse
        window.addEventListener('resize', updateFullscreenNotice);

        // Tjek når fuldskærms-status ændres
        document.addEventListener('fullscreenchange', updateFullscreenNotice);
        document.addEventListener('webkitfullscreenchange', updateFullscreenNotice);
        document.addEventListener('mozfullscreenchange', updateFullscreenNotice);
        document.addEventListener('msfullscreenchange', updateFullscreenNotice);
    </script>

    <script src="script.js"></script>
</body>
</html>
